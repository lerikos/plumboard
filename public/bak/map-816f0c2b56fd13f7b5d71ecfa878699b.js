function displayMap(a,b,c,d){if(c)var e=11;else var e=16;var f={zoom:e,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};$("#map_canvas").length!=0&&(map=new google.maps.Map(document.getElementById("map_canvas"),f),c||directionsDisplay.setMap(map),$("#directionsPanel").length!=0&&getDirections(),showMarkers(map,a,b,c,d)),google.maps.event.trigger(map,"resize")}function showMarkers(a,b,c,d,e){if(markers!==undefined)if(markers.length>10)var f=10;else var f=markers.length;if(c)var g=new google.maps.Marker({position:b,map:a});if(d)for(i=0;i<f;i++){var h=markers[i];if(e)var j=new google.maps.LatLng(h[1],h[2]),k=h[0],l=h[3];else var j=h,k=locations[i],l=1;var g=new google.maps.Marker({position:j,map:a,icon:"http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+i.toString()+"|339999|000000",title:k,zIndex:l})}}function NewInitialize(a,b,c){directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer,selectedLocation=new google.maps.LatLng(a,b),displayMap(selectedLocation,c,!1,!1)}function loadLocations(a,b){b?getLocCenter(a,b):processLocations(a,b)}function getLocCenter(a,b){markers=a;if(myLocation!==undefined)displayMap(myLocation,!1,!0,b);else if(a!==undefined){k=a.length-1;var c=a[k],d=new google.maps.LatLng(c[1],c[2]);displayMap(d,!1,!0,b)}}function processLocations(a,b){markers=[],marker_num=0,geocoder=new google.maps.Geocoder,centerPt=new google.maps.LatLngBounds,locations=a;if(a!==undefined)for(k=0;k<a.length;k++){var c=a[k];geocoder.geocode({address:c},function(c,d){d==google.maps.GeocoderStatus.OK&&(centerPt.extend(c[0].geometry.location),markers[marker_num]=c[0].geometry.location,marker_num++,k==a.length&&displayMap(centerPt.getCenter(),!1,!0,b))})}}function getLatLng(a){if($(".lnglat").length!=0){var b=$(".lnglat").attr("data-lnglat");if(b!==undefined&&b!=""){var c=parseFloat(b.split(", ")[0].split('["')[1]);if(!isNaN(c))var d=parseFloat(b.split(', "')[1].split('"]')[0]);else{c=parseFloat(b.split(", ")[0].split("[")[1]);var d=parseFloat(b.split(", ")[1].split("]")[0])}NewInitialize(c,d,a)}else alert("Address not found.")}}function getMyLocation(a,b){url="/nearby_events.mobile";var c={maximumAge:6e4,enableHighAccuracy:!0,timeout:3e4};navigator.geolocation.getCurrentPosition(function(c){myLocation=new google.maps.LatLng(c.coords.latitude,c.coords.longitude);if(b){if(myLocation!==undefined){var d=myLocation.toString().split(")"),e=d[0].split("(");url=url+"?loc="+e[1]}window.location.href=url}if(a){if($("#mode").length!=0)var f=$("#mode").val();else var f="DRIVING";var g={origin:myLocation,destination:selectedLocation,travelMode:google.maps.TravelMode[f]};directionsService.route(g,function(a,b){b==google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(a)})}},function(b){a||goToUrl(url)},c)}function calcRoute(){getLatLng(!1),getMyLocation(!0,!1)}function getDirections(){$("#directionsPanel").empty(),directionsDisplay.setPanel(document.getElementById("directionsPanel"))}function detectBrowser(){var a=navigator.userAgent,b=document.getElementById("map_canvas");a.indexOf("iPhone")!=-1||a.indexOf("Android")!=-1?(b.style.width="100%",b.style.height="100%"):(b.style.width="600px",b.style.height="800px")}var map,selectedLocation,myLocation,directionsDisplay,directionsService,url,geocoder,centerPt,markers,marker_num,locations;